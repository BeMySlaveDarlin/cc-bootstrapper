Прочитай файл `$ARGUMENTS` и выполни ВСЕ шаги из него последовательно для текущего проекта.

Если аргумент не указан — ищи промпт в таком порядке:
1. `.claude/prompts/meta-prompt-bootstrap.md` в текущем проекте
2. `~/.claude/prompts/meta-prompt-bootstrap.md` (глобальная копия)

Если файл не найден ни там, ни там — сообщи пользователю.

## PRE-CHECK: Проверка соответствия схеме

**ПЕРЕД выполнением шагов** проверь, полностью ли проект уже соответствует схеме bootstrap. Проверь ВСЕ условия:

1. `.claude/agents/` — содержит `.md` файлы агентов (минимум: `*-architect.md`, `*-developer.md`, `*-test-developer.md`, `*-reviewer-logic.md`, `*-reviewer-security.md`, `db-architect.md`, `devops.md`)
2. `.claude/skills/` — содержит поддиректории с `SKILL.md` (`code-style/`, `architecture/`, `database/`, `testing/`, `routing/`)
3. `.claude/pipelines/` — содержит все 8 пайплайнов (`new-code.md`, `fix-code.md`, `review.md`, `tests.md`, `api-docs.md`, `qa-docs.md`, `full-feature.md`, `hotfix.md`)
4. `.claude/scripts/hooks/` — содержит `track-agent.sh`, `session-summary.sh` и `update-schema.sh` (все executable)
5. `.claude/state/` — содержит `session.md` и `task-log.md`
6. `.claude/settings.json` — существует, валидный JSON
7. `CLAUDE.md` — существует и содержит секции: `## Agents`, `## Skills`, `## Pipelines`, `## Commands`, `## Architecture`
8. `.claude/input/` — существует (директория для задач и планов)
9. `.claude/database/` — существует (если проект использует БД)

**Если ВСЕ условия выполнены:**
- Выведи `[SKIP] Проект уже полностью соответствует схеме bootstrap. Изменения не требуются.`
- Покажи краткую сводку: количество агентов, скиллов, пайплайнов, хуков
- **ЗАВЕРШИСЬ. Не выполняй шаги.**

**Если частично выполнены** — выведи список `[OK]` / `[MISS]` по каждому пункту и продолжи выполнение только недостающих шагов.

**Если ничего нет** — выполняй все шаги полностью.

---

## INTERACTIVE: Подтверждение действий с пользователем

Перед выполнением шагов, **если проект не пустой** (уже есть `.claude/` или `CLAUDE.md`), спроси у пользователя:

### 1. Settings

Если `.claude/settings.json` уже существует:
- Покажи текущее содержимое
- Спроси: **Перезаписать `.claude/settings.json`?** (Да / Нет / Merge — добавить недостающие permissions)

Если `.claude/settings.local.json` уже существует:
- Покажи текущее содержимое
- Спроси: **Перезаписать `.claude/settings.local.json`?** (Да / Нет / Merge)

### 2. Очистка устаревшего

Проверь наличие потенциально устаревших файлов и директорий:
- Любые `.md` файлы в `.claude/agents/` которые не соответствуют текущей схеме именования
- `.claude/state/usage.jsonl` — может быть большим, предложить архивировать

Если найдено что-то из списка:
- Покажи список найденного
- Спроси: **Удалить устаревшие файлы?** (Да, все / Выбрать вручную / Нет, оставить)
- При «Выбрать вручную» — показать каждый файл отдельно

### 3. Память и state

Если `.claude/state/session.md` содержит данные активной сессии (не пустой шаблон):
- Спроси: **Сбросить state/session.md?** (Да / Нет — сохранить текущую сессию)

Если `.claude/state/task-log.md` содержит записи:
- Спроси: **Очистить task-log.md?** (Да / Нет — сохранить историю)

**Если проект пустой** — пропускай INTERACTIVE, создавай всё с нуля.

---

Выполняй шаги строго по порядку (Шаг 1 → 2 → 3 → 4 → 5). После каждого шага выводи краткий отчёт. Не пропускай генерацию файлов — создавай все агенты, скиллы, пайплайны, hooks, settings, state.
